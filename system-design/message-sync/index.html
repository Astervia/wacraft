
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wacraft.astervia.tech/system-design/message-sync/">
      
      
        <link rel="prev" href="../../support/consulting/">
      
      
      
      <link rel="icon" href="../../assets/images/icon-nobg.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.13">
    
    
      
        <title>Message Syncing & Status Flow - wacraft</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#message-and-status-synchronization-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="wacraft" class="md-header__button md-logo" aria-label="wacraft" data-md-component="logo">
      
  <img src="../../assets/images/icon-nobg.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            wacraft
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Message Syncing & Status Flow
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81zM1 13h3v-2H1m12 9h-2v3h2"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="wacraft" class="md-nav__button md-logo" aria-label="wacraft" data-md-component="logo">
      
  <img src="../../assets/images/icon-nobg.png" alt="logo">

    </a>
    wacraft
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Quick‑Start
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Quick‑Start
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local Setup (5 min)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Production Deploy (Docker / Vercel)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/meta-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Meta Credentials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/env-vars/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Env Vars Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/webhook-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Webhook Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deployment Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Deployment Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/docker-compose/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker Compose
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/binary-vercel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Binary + Vercel (frontend)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/node-red/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node‑RED Integration*
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Usage Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Product Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UI Walkthrough
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/campaigns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Campaigns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQs & Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/getting-started-supporters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started (Supporters)*
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Support Our Mission
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Support Our Mission
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../support/plans/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plans
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../support/consulting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Consulting Services
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Technical Internals + System Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Technical Internals + System Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Message Syncing & Status Flow
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Message Syncing & Status Flow
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      The Challenge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-synchronization-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      Core Synchronization Mechanism
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Synchronization Mechanism">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messagestatussynchronizer-structure" class="md-nav__link">
    <span class="md-ellipsis">
      MessageStatusSynchronizer Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-instance" class="md-nav__link">
    <span class="md-ellipsis">
      Global Instance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronization-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synchronization Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-sending-a-message-outbound-flow" class="md-nav__link">
    <span class="md-ellipsis">
      1. Sending a Message (Outbound Flow)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Sending a Message (Outbound Flow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-by-step-process" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-step Process:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-receiving-status-update-webhook-flow" class="md-nav__link">
    <span class="md-ellipsis">
      2. Receiving Status Update (Webhook Flow)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Receiving Status Update (Webhook Flow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-by-step-process_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-step Process:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronization-methods-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization Methods Explained
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synchronization Methods Explained">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addmessage" class="md-nav__link">
    <span class="md-ellipsis">
      AddMessage()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addstatus" class="md-nav__link">
    <span class="md-ellipsis">
      AddStatus()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#messagesaved" class="md-nav__link">
    <span class="md-ellipsis">
      MessageSaved()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollbackmessage" class="md-nav__link">
    <span class="md-ellipsis">
      RollbackMessage()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timeout-setting" class="md-nav__link">
    <span class="md-ellipsis">
      Timeout Setting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-specific-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Environment-Specific Behavior
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment-Specific Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-development-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Local Development Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#race-condition-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Race Condition Scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Race Condition Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-status-arrives-before-message-is-saved" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 1: Status Arrives Before Message is Saved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-message-saved-before-status-arrives" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 2: Message Saved Before Status Arrives
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-message-creation-fails-after-whatsapp-accepts" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 3: Message Creation Fails After WhatsApp Accepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-4-multiple-status-updates-for-same-message" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 4: Multiple Status Updates for Same Message
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-send-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Message Send Failures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#status-processing-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Status Processing Failures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Message Transaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#status-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Status Transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Database Schema Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messages-table" class="md-nav__link">
    <span class="md-ellipsis">
      Messages Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-messages-by-wamid" class="md-nav__link">
    <span class="md-ellipsis">
      Finding Messages by wamID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#status-table" class="md-nav__link">
    <span class="md-ellipsis">
      Status Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel-management" class="md-nav__link">
    <span class="md-ellipsis">
      Channel Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goroutine-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Goroutine Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Database Queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrent Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-development" class="md-nav__link">
    <span class="md-ellipsis">
      Local Development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulating-race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Simulating Race Conditions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Debugging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timeout-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Timeout Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggested-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Suggested Metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      Future Improvements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Improvements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#potential-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      Potential Optimizations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      The Challenge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-synchronization-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      Core Synchronization Mechanism
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Synchronization Mechanism">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messagestatussynchronizer-structure" class="md-nav__link">
    <span class="md-ellipsis">
      MessageStatusSynchronizer Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-instance" class="md-nav__link">
    <span class="md-ellipsis">
      Global Instance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronization-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synchronization Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-sending-a-message-outbound-flow" class="md-nav__link">
    <span class="md-ellipsis">
      1. Sending a Message (Outbound Flow)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Sending a Message (Outbound Flow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-by-step-process" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-step Process:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-receiving-status-update-webhook-flow" class="md-nav__link">
    <span class="md-ellipsis">
      2. Receiving Status Update (Webhook Flow)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Receiving Status Update (Webhook Flow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-by-step-process_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-step Process:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronization-methods-explained" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization Methods Explained
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synchronization Methods Explained">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addmessage" class="md-nav__link">
    <span class="md-ellipsis">
      AddMessage()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addstatus" class="md-nav__link">
    <span class="md-ellipsis">
      AddStatus()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#messagesaved" class="md-nav__link">
    <span class="md-ellipsis">
      MessageSaved()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollbackmessage" class="md-nav__link">
    <span class="md-ellipsis">
      RollbackMessage()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timeout-setting" class="md-nav__link">
    <span class="md-ellipsis">
      Timeout Setting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-specific-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Environment-Specific Behavior
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment-Specific Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-development-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Local Development Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#race-condition-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Race Condition Scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Race Condition Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-status-arrives-before-message-is-saved" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 1: Status Arrives Before Message is Saved
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-message-saved-before-status-arrives" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 2: Message Saved Before Status Arrives
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-message-creation-fails-after-whatsapp-accepts" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 3: Message Creation Fails After WhatsApp Accepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-4-multiple-status-updates-for-same-message" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 4: Multiple Status Updates for Same Message
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-send-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Message Send Failures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#status-processing-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Status Processing Failures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Message Transaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#status-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Status Transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Database Schema Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#messages-table" class="md-nav__link">
    <span class="md-ellipsis">
      Messages Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-messages-by-wamid" class="md-nav__link">
    <span class="md-ellipsis">
      Finding Messages by wamID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#status-table" class="md-nav__link">
    <span class="md-ellipsis">
      Status Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel-management" class="md-nav__link">
    <span class="md-ellipsis">
      Channel Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goroutine-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Goroutine Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Database Queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrent Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-development" class="md-nav__link">
    <span class="md-ellipsis">
      Local Development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulating-race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Simulating Race Conditions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring and Debugging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timeout-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Timeout Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggested-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Suggested Metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      Future Improvements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Improvements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#potential-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      Potential Optimizations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="message-and-status-synchronization-documentation">Message and Status Synchronization Documentation</h1>
<h2 id="overview">Overview</h2>
<p>The wacraft server implements a sophisticated synchronization mechanism to coordinate messages sent to WhatsApp with status updates received via webhooks. This ensures that every message in the database has an associated initial status, even when status updates arrive before the message is fully persisted.</p>
<h2 id="the-challenge">The Challenge</h2>
<p>When sending a message to WhatsApp, there's a race condition between:</p>
<ol>
<li><strong>Message creation flow</strong>: API request → WhatsApp API call → Database insert → Response to client</li>
<li><strong>Status update flow</strong>: WhatsApp webhook → Status processing → Database insert</li>
</ol>
<p>WhatsApp can send status updates extremely quickly (sometimes in milliseconds), potentially arriving before the message has been saved to the database. Without synchronization, the status update might fail to find its corresponding message.</p>
<h2 id="core-synchronization-mechanism">Core Synchronization Mechanism</h2>
<h3 id="messagestatussynchronizer-structure">MessageStatusSynchronizer Structure</h3>
<p>Located in: <code>src/message/service/synchronize-message-and-status.go:13-145</code></p>
<pre><code class="language-go">type MessageStatusSynchronizer struct {
    channels map[string]*chan string // Channels indexed by WhatsApp Message ID (wamID)
    mu       *sync.Mutex             // Protects concurrent access to channels map
}
</code></pre>
<p>The synchronizer uses Go channels to coordinate between message creation and status updates:</p>
<ul>
<li><strong>Key</strong>: WhatsApp Message ID (wamID) - the unique identifier WhatsApp assigns to each message</li>
<li><strong>Value</strong>: A string channel that communicates the message UUID once it's saved</li>
</ul>
<h3 id="global-instance">Global Instance</h3>
<p>A global singleton instance is created and shared across the application:</p>
<pre><code class="language-go">var StatusSynchronizer = CreateMessageStatusSynchronizer()
</code></pre>
<p>Located at: <code>src/message/service/synchronize-message-and-status.go:144</code></p>
<h2 id="synchronization-flow">Synchronization Flow</h2>
<h3 id="1-sending-a-message-outbound-flow">1. Sending a Message (Outbound Flow)</h3>
<p>Located in: <code>src/message/service/whatsapp.go:47-121</code></p>
<h4 id="step-by-step-process">Step-by-step Process:</h4>
<ol>
<li>
<p><strong>API Request Received</strong> (<code>src/message/handler/whatsapp.go:28</code>)</p>
<ul>
<li>Client sends POST request to <code>/message/whatsapp</code></li>
<li>Request body is validated</li>
</ul>
</li>
<li>
<p><strong>Message Preparation</strong></p>
<ul>
<li>Contact lookup in database</li>
<li>Message content is built with WhatsApp-specific format</li>
</ul>
</li>
<li>
<p><strong>WhatsApp API Call</strong> (<code>src/message/service/whatsapp.go:80</code>)</p>
<p><code>go
response, err := message_service.Send(whatsapp.WabaApi, body.SenderData)</code></p>
<ul>
<li>Message is sent to WhatsApp's Graph API</li>
<li>WhatsApp returns a <code>wamID</code> (WhatsApp Message ID)</li>
</ul>
</li>
<li>
<p><strong>Register with Synchronizer</strong> (<code>src/message/service/whatsapp.go:92-98</code>)</p>
<p><code>go
err = StatusSynchronizer.AddMessage(
    message.ProductData.Messages[0].ID.ID,  // wamID
    env.MessageStatusSyncTimeout,           // 20 seconds timeout
)</code></p>
<ul>
<li>Creates a channel for this wamID</li>
<li><strong>Blocks here</strong> waiting for either:<ul>
<li>A status update to signal the channel</li>
<li>A timeout (20 seconds default)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Database Insert</strong> (<code>src/message/service/whatsapp.go:101-108</code>)</p>
<p><code>go
err = tx.Create(&amp;message).Error
if err != nil {
    StatusSynchronizer.RollbackMessage(wamID, timeout)
    return message, err
}</code></p>
<ul>
<li>If successful: Message is saved with generated UUID</li>
<li>If failed: Rollback signal is sent to unblock any waiting status</li>
</ul>
</li>
<li>
<p><strong>Signal Message Saved</strong> (<code>src/message/service/whatsapp.go:110-118</code>)</p>
<p><code>go
go func() {
    StatusSynchronizer.MessageSaved(
        message.ProductData.Messages[0].ID.ID,  // wamID
        message.ID,                              // Database UUID
        env.MessageStatusSyncTimeout,
    )
}()</code></p>
<ul>
<li>Sends the database UUID through the channel</li>
<li>This unblocks the waiting status handler (if any)</li>
</ul>
</li>
</ol>
<h3 id="2-receiving-status-update-webhook-flow">2. Receiving Status Update (Webhook Flow)</h3>
<p>Located in: <code>src/webhook-in/handler/whatsapp-message-status.go:26-114</code></p>
<h4 id="step-by-step-process_1">Step-by-step Process:</h4>
<ol>
<li>
<p><strong>Webhook Received</strong> (<code>src/webhook-in/handler/whatsapp-message.go:36</code>)</p>
<ul>
<li>WhatsApp sends POST request to webhook endpoint</li>
<li>Contains status updates array</li>
</ul>
</li>
<li>
<p><strong>Extract wamID</strong> (<code>src/webhook-in/handler/whatsapp-message-status.go:36</code>)</p>
<p><code>go
wamID := status.ID</code></p>
<ul>
<li>The WhatsApp Message ID from the status update</li>
</ul>
</li>
<li>
<p><strong>Lock for Race Condition</strong> (<code>src/webhook-in/handler/whatsapp-message-status.go:38</code>)</p>
<p><code>go
statusSynchronizer.Lock(wamID)</code></p>
<ul>
<li>Prevents multiple status updates for the same message from processing simultaneously</li>
<li>This is a separate synchronizer (<code>MutexSwapper</code>) from the message-status synchronizer</li>
</ul>
</li>
<li>
<p><strong>Check if Message Exists</strong> (<code>src/webhook-in/handler/whatsapp-message-status.go:40-60</code>)</p>
<p><code>go
msgs, err := message_service.GetWamID(
    wamID,
    message_entity.Message{MessagingProductID: mpID},
    &amp;database_model.Paginate{Offset: 0, Limit: 1},
    &amp;database_model.DateOrder{CreatedAt: &amp;ascending},
    nil,
    tx,
)</code></p>
<ul>
<li>Queries database using JSONB operators to find message by wamID</li>
<li>Query checks both <code>receiver_data</code> and <code>product_data.messages</code> fields</li>
</ul>
</li>
<li>
<p><strong>Two Paths Based on Message Existence:</strong></p>
<p><strong>Path A: Message Found</strong> (<code>src/webhook-in/handler/whatsapp-message-status.go:74-88</code>)</p>
<p><code>go
statusSynchronizer.Unlock(wamID)
msg := msgs[0]
msgID = msg.ID</code></p>
<ul>
<li>Message already exists in database</li>
<li>Use its UUID directly</li>
<li>Unlock immediately since no waiting needed</li>
</ul>
<p><strong>Path B: Message Not Found</strong> (<code>src/webhook-in/handler/whatsapp-message-status.go:62-73</code>)</p>
<p><code>go
msgID, err = message_service.StatusSynchronizer.AddStatus(
    wamID,
    status.Status,
    env.MessageStatusSyncTimeout,
)
statusSynchronizer.Unlock(wamID)</code></p>
<ul>
<li>Message hasn't been saved yet (race condition detected)</li>
<li><strong>Blocks here</strong> waiting for message to be saved</li>
<li>Receives message UUID when <code>MessageSaved()</code> is called</li>
<li>If error (timeout or rollback), returns <code>nil</code> error to WhatsApp to avoid retries</li>
</ul>
</li>
<li>
<p><strong>Save Status</strong> (<code>src/webhook-in/handler/whatsapp-message-status.go:90-106</code>)</p>
<p><code>go
s, err := repository.Create(
    status_entity.Status{
        StatusFields: status_model.StatusFields{
            MessageID: msgID,
            ProductData: &amp;status_model.ProductData{
                Status: &amp;status,
            },
        },
    },
    tx,
)</code></p>
<ul>
<li>Status is saved with the correct message UUID</li>
<li>Transaction ensures atomicity</li>
</ul>
</li>
</ol>
<h2 id="synchronization-methods-explained">Synchronization Methods Explained</h2>
<h3 id="addmessage">AddMessage()</h3>
<p>Located at: <code>src/message/service/synchronize-message-and-status.go:20-42</code></p>
<p>Called by the message sender to wait for status confirmation.</p>
<p><strong>Behavior:</strong></p>
<ul>
<li>Creates a channel if one doesn't exist for this wamID</li>
<li>Blocks waiting on the channel</li>
<li>Unblocks when:<ul>
<li>A status arrives and signals the channel (AddStatus)</li>
<li>Message is saved and signals completion (MessageSaved)</li>
<li>Timeout occurs (default 20 seconds)</li>
</ul>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul>
<li><code>nil</code> if status arrives before timeout</li>
<li><code>error</code> if timeout occurs</li>
</ul>
<h3 id="addstatus">AddStatus()</h3>
<p>Located at: <code>src/message/service/synchronize-message-and-status.go:84-135</code></p>
<p>Called by the webhook handler when a status arrives before the message is saved.</p>
<p><strong>Behavior:</strong></p>
<ol>
<li>Creates a channel if one doesn't exist for this wamID</li>
<li><strong>First signal</strong>: Sends empty string to unblock waiting AddMessage()</li>
<li><strong>Wait for second signal</strong>: Blocks waiting for MessageSaved() to send the UUID</li>
<li>Returns the message UUID once received</li>
</ol>
<p><strong>Returns:</strong></p>
<ul>
<li><code>uuid.UUID</code> of the message</li>
<li><code>error</code> if timeout or message was rolled back</li>
</ul>
<h3 id="messagesaved">MessageSaved()</h3>
<p>Located at: <code>src/message/service/synchronize-message-and-status.go:64-81</code></p>
<p>Called after successfully saving a message to the database.</p>
<p><strong>Behavior:</strong></p>
<ul>
<li>Sends the message UUID through the channel</li>
<li>Unblocks any waiting AddStatus() call</li>
<li>Cleans up the channel from the map</li>
</ul>
<h3 id="rollbackmessage">RollbackMessage()</h3>
<p>Located at: <code>src/message/service/synchronize-message-and-status.go:44-61</code></p>
<p>Called when message creation fails after WhatsApp accepted it.</p>
<p><strong>Behavior:</strong></p>
<ul>
<li>Sends empty string through the channel</li>
<li>Signals to AddStatus() that message was rolled back</li>
<li>AddStatus() will return an error when it receives empty string</li>
</ul>
<h2 id="configuration">Configuration</h2>
<h3 id="timeout-setting">Timeout Setting</h3>
<p>Located at: <code>src/config/env/whatsapp.go:18</code></p>
<pre><code class="language-go">MessageStatusSyncTimeout = 20 * time.Second
</code></pre>
<p>Can be configured via environment variable:</p>
<ul>
<li>Variable: <code>MESSAGE_STATUS_SYNC_TIMEOUT_SEC</code></li>
<li>Default: 20 seconds</li>
<li>Purpose: Maximum time to wait for synchronization</li>
</ul>
<p>This timeout applies to:</p>
<ul>
<li>Waiting for status when sending a message</li>
<li>Waiting for message UUID when status arrives first</li>
<li>Signaling operations</li>
</ul>
<h2 id="environment-specific-behavior">Environment-Specific Behavior</h2>
<h3 id="local-development-mode">Local Development Mode</h3>
<p>Located at: <code>src/message/service/whatsapp.go:31-35</code></p>
<pre><code class="language-go">if common_service.IsEnvLocal() {
    msg, err = SendWhatsAppMessageAtTransactionWithoutWaitingForStatus(body, mp.ID, nil)
} else {
    msg, err = SendWhatsAppMessageAtTransaction(body, mp.ID, nil)
}
</code></pre>
<p>In local development:</p>
<ul>
<li>Uses <code>SendWhatsAppMessageAtTransactionWithoutWaitingForStatus()</code></li>
<li>Does NOT block the HTTP response waiting for status</li>
<li>AddMessage runs in a goroutine</li>
<li>HTTP request completes faster</li>
<li>Located at: <code>src/message/service/whatsapp.go:124-208</code></li>
</ul>
<p>In production:</p>
<ul>
<li>Uses <code>SendWhatsAppMessageAtTransaction()</code></li>
<li>BLOCKS the HTTP response until status arrives</li>
<li>Ensures status exists before responding to client</li>
<li>Located at: <code>src/message/service/whatsapp.go:47-121</code></li>
</ul>
<h2 id="race-condition-scenarios">Race Condition Scenarios</h2>
<h3 id="scenario-1-status-arrives-before-message-is-saved">Scenario 1: Status Arrives Before Message is Saved</h3>
<p><strong>Timeline:</strong></p>
<pre><code>T0: Client sends message → WhatsApp API
T1: WhatsApp API accepts (returns wamID)
T2: AddMessage() called, blocks waiting
T3: ⚡ WhatsApp webhook arrives with status
T4: AddStatus() called, signals to unblock T2
T5: AddStatus() blocks waiting for message UUID
T6: Database insert completes
T7: MessageSaved() called with UUID
T8: AddStatus() receives UUID, unblocks
T9: Status saved with correct message UUID
</code></pre>
<p><strong>Result:</strong> ✅ Status correctly linked to message</p>
<h3 id="scenario-2-message-saved-before-status-arrives">Scenario 2: Message Saved Before Status Arrives</h3>
<p><strong>Timeline:</strong></p>
<pre><code>T0: Client sends message → WhatsApp API
T1: WhatsApp API accepts (returns wamID)
T2: AddMessage() called, blocks waiting
T3: Database insert completes
T4: MessageSaved() called
T5: ⏱️ Waiting for status...
T6: Timeout occurs (20 seconds)
T7: AddMessage() returns timeout error
T8: Message exists in database
T9: ⚡ WhatsApp webhook arrives (late)
T10: GetWamID() finds existing message
T11: Status saved with message UUID from database
</code></pre>
<p><strong>Result:</strong> ✅ Status saved using database lookup (no synchronization needed)</p>
<h3 id="scenario-3-message-creation-fails-after-whatsapp-accepts">Scenario 3: Message Creation Fails After WhatsApp Accepts</h3>
<p><strong>Timeline:</strong></p>
<pre><code>T0: Client sends message → WhatsApp API
T1: WhatsApp API accepts (returns wamID)
T2: AddMessage() called, blocks waiting
T3: ⚡ WhatsApp webhook arrives with status
T4: AddStatus() called, signals to unblock T2
T5: AddStatus() blocks waiting for message UUID
T6: ❌ Database insert fails (e.g., constraint violation)
T7: RollbackMessage() called, sends empty string
T8: AddStatus() receives empty string
T9: AddStatus() returns &quot;message rolled back&quot; error
T10: Status NOT saved, returns nil to WhatsApp
</code></pre>
<p><strong>Result:</strong> ✅ Status discarded, no orphaned status record</p>
<h3 id="scenario-4-multiple-status-updates-for-same-message">Scenario 4: Multiple Status Updates for Same Message</h3>
<p>WhatsApp sends status progressions: <code>sent</code> → <code>delivered</code> → <code>read</code></p>
<p><strong>Concurrency Protection:</strong></p>
<pre><code class="language-go">statusSynchronizer.Lock(wamID)
// ... process status ...
statusSynchronizer.Unlock(wamID)
</code></pre>
<p>Located at: <code>src/webhook-in/handler/whatsapp-message-status.go:38</code></p>
<p>This <code>MutexSwapper</code> ensures:</p>
<ul>
<li>Only one status update per wamID processes at a time</li>
<li>Second status waits until first completes</li>
<li>Prevents duplicate processing</li>
<li>Prevents race conditions in database queries</li>
</ul>
<h2 id="error-handling">Error Handling</h2>
<h3 id="message-send-failures">Message Send Failures</h3>
<ol>
<li>
<p><strong>Before WhatsApp API Call</strong></p>
<ul>
<li>No synchronization needed</li>
<li>Error returned immediately</li>
<li>No cleanup required</li>
</ul>
</li>
<li>
<p><strong>WhatsApp API Rejects</strong></p>
<ul>
<li>Synchronization not started</li>
<li>Error returned to client</li>
<li>No status expected</li>
</ul>
</li>
<li>
<p><strong>After WhatsApp API, Before DB Save</strong></p>
<ul>
<li>AddMessage() is waiting</li>
<li>Database insert fails</li>
<li>RollbackMessage() signals the failure</li>
<li>Any waiting status receives rollback signal</li>
</ul>
</li>
</ol>
<h3 id="status-processing-failures">Status Processing Failures</h3>
<ol>
<li>
<p><strong>Timeout Waiting for Message</strong></p>
<p><code>go
msgID, err = message_service.StatusSynchronizer.AddStatus(...)
if err != nil {
    // Returns nil to WhatsApp (don't retry)
    return nil
}</code></p>
<ul>
<li>Status arrives but message never saves</li>
<li>After 20 seconds, timeout occurs</li>
<li>Returns <code>nil</code> error to WhatsApp (200 OK response)</li>
<li>WhatsApp won't retry this specific status</li>
<li>Message may have status from database lookup on retry</li>
</ul>
</li>
<li>
<p><strong>Message Rolled Back</strong></p>
<ul>
<li>AddStatus() receives empty string</li>
<li>Returns "message rolled back" error</li>
<li>Returns <code>nil</code> to WhatsApp (don't retry)</li>
</ul>
</li>
<li>
<p><strong>Database Insert Fails</strong></p>
<ul>
<li>Transaction rolls back</li>
<li>Error propagates up</li>
<li>WhatsApp may retry webhook</li>
</ul>
</li>
</ol>
<h2 id="transaction-handling">Transaction Handling</h2>
<h3 id="message-transaction">Message Transaction</h3>
<p>Located at: <code>src/message/service/whatsapp.go:58-62</code></p>
<pre><code class="language-go">transactionProvided := tx != nil
if tx == nil {
    tx = database.DB
}
</code></pre>
<ul>
<li>Supports external transactions (for bulk operations)</li>
<li>If no transaction provided, uses database directly</li>
<li>MessageSaved() only called if no transaction provided</li>
<li>In transactions, caller is responsible for signaling</li>
</ul>
<h3 id="status-transaction">Status Transaction</h3>
<p>Located at: <code>src/webhook-in/handler/whatsapp-message.go:51-86</code></p>
<pre><code class="language-go">tx := database.DB.Begin()
// ... process messages and statuses ...
if err := tx.Commit().Error; err != nil {
    return err
}
</code></pre>
<ul>
<li>All status updates in single webhook are atomic</li>
<li>Multiple statuses committed together</li>
<li>On error, all statuses rolled back</li>
</ul>
<h2 id="database-schema-integration">Database Schema Integration</h2>
<h3 id="messages-table">Messages Table</h3>
<p>Messages store their WhatsApp metadata in JSONB fields:</p>
<p><strong>product_data (JSONB):</strong></p>
<pre><code class="language-json">{
    &quot;messages&quot;: [
        {
            &quot;id&quot;: &quot;wamid.HBgNNTU5...&quot; // WhatsApp Message ID
        }
    ]
}
</code></pre>
<p><strong>receiver_data (JSONB):</strong></p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;wamid.HBgNNTU5...&quot; // For received messages
}
</code></pre>
<h3 id="finding-messages-by-wamid">Finding Messages by wamID</h3>
<p>Located at: <code>src/message/service/wam-id.go:29-39</code></p>
<pre><code class="language-sql">WHERE receiver_data-&gt;&gt;'id' = ?
   OR EXISTS (
       SELECT 1 FROM jsonb_array_elements(product_data-&gt;'messages') AS m(message)
       WHERE m.message-&gt;&gt;'id' = ?
   )
</code></pre>
<p>This query efficiently finds messages whether they were sent or received.</p>
<h3 id="status-table">Status Table</h3>
<pre><code class="language-go">type Status struct {
    MessageID   uuid.UUID  // Foreign key to messages table
    ProductData JSONB      // Contains WhatsApp status details
}
</code></pre>
<h2 id="performance-considerations">Performance Considerations</h2>
<h3 id="channel-management">Channel Management</h3>
<p>Channels are created on-demand and cleaned up after use:</p>
<pre><code class="language-go">defer func() {
    m.mu.Lock()
    delete(m.channels, wamID)
    m.mu.Unlock()
}()
</code></pre>
<p>This prevents memory leaks from accumulating channels.</p>
<h3 id="goroutine-usage">Goroutine Usage</h3>
<p>MessageSaved() runs in a goroutine:</p>
<pre><code class="language-go">go func() {
    if !transactionProvided {
        StatusSynchronizer.MessageSaved(wamID, message.ID, timeout)
    }
}()
</code></pre>
<p>This prevents blocking the main message creation flow.</p>
<h3 id="database-queries">Database Queries</h3>
<p>Status processing queries messages with:</p>
<ul>
<li>Limit of 1 result</li>
<li>Ascending date order (oldest first)</li>
<li>Efficient JSONB indexing</li>
</ul>
<h3 id="concurrent-processing">Concurrent Processing</h3>
<p>Webhooks process multiple statuses concurrently:</p>
<pre><code class="language-go">var eg errgroup.Group
for _, status := range *value.Statuses {
    eg.Go(func() error {
        // Process status
    })
}
</code></pre>
<h2 id="testing-considerations">Testing Considerations</h2>
<h3 id="local-development">Local Development</h3>
<p>Set environment to local to avoid blocking on status:</p>
<pre><code class="language-bash">export ENV=local
</code></pre>
<h3 id="simulating-race-conditions">Simulating Race Conditions</h3>
<ol>
<li>
<p><strong>Status before message:</strong></p>
<ul>
<li>Send webhook immediately after getting wamID</li>
<li>Add delay before database insert</li>
</ul>
</li>
<li>
<p><strong>Status timeout:</strong></p>
<ul>
<li>Block webhook endpoint</li>
<li>Send message</li>
<li>Wait 20+ seconds</li>
<li>Unblock webhook</li>
</ul>
</li>
<li>
<p><strong>Message rollback:</strong></p>
<ul>
<li>Break database constraint</li>
<li>Send message (will fail after WhatsApp accepts)</li>
<li>Send webhook</li>
<li>Verify status not created</li>
</ul>
</li>
</ol>
<h2 id="monitoring-and-debugging">Monitoring and Debugging</h2>
<h3 id="timeout-monitoring">Timeout Monitoring</h3>
<p>Watch for timeout errors in logs:</p>
<pre><code>&quot;timeout waiting for whatsapp message status update&quot;
&quot;timeout waiting to signal message saved&quot;
&quot;timeout waiting for message added&quot;
</code></pre>
<p>These indicate:</p>
<ul>
<li>WhatsApp webhook delays</li>
<li>Database performance issues</li>
<li>Network problems</li>
</ul>
<h3 id="suggested-metrics">Suggested Metrics</h3>
<ol>
<li>
<p><strong>Synchronization Success Rate</strong></p>
<ul>
<li>Messages that complete within timeout</li>
<li>Target: &gt;99%</li>
</ul>
</li>
<li>
<p><strong>Average Wait Time</strong></p>
<ul>
<li>Time spent in AddMessage() or AddStatus()</li>
<li>Target: &lt;1 second</li>
</ul>
</li>
<li>
<p><strong>Timeout Rate</strong></p>
<ul>
<li>Percentage of operations timing out</li>
<li>Target: &lt;0.1%</li>
</ul>
</li>
<li>
<p><strong>Status Arrival Order</strong></p>
<ul>
<li>Count of statuses arriving before vs. after message save</li>
<li>Helps tune timeout values</li>
</ul>
</li>
</ol>
<h2 id="future-improvements">Future Improvements</h2>
<h3 id="potential-optimizations">Potential Optimizations</h3>
<ol>
<li>
<p><strong>Redis-based Synchronization</strong></p>
<ul>
<li>Replace in-memory channels with Redis pub/sub</li>
<li>Enables horizontal scaling across multiple server instances</li>
<li>Current limitation: synchronization only works within single process</li>
</ul>
</li>
<li>
<p><strong>Adaptive Timeouts</strong></p>
<ul>
<li>Monitor actual wait times</li>
<li>Adjust timeout based on percentiles</li>
<li>Reduce unnecessary waiting</li>
</ul>
</li>
<li>
<p><strong>Status Buffering</strong></p>
<ul>
<li>Buffer early status updates in memory</li>
<li>Retry attachment after short delay</li>
<li>Reduce database queries</li>
</ul>
</li>
<li>
<p><strong>Webhook Ordering</strong></p>
<ul>
<li>WhatsApp doesn't guarantee order</li>
<li>Could implement sequence numbers</li>
<li>Ensure statuses process in correct order</li>
</ul>
</li>
</ol>
<h2 id="summary">Summary</h2>
<p>The message-status synchronization system ensures data consistency by:</p>
<ul>
<li>Using Go channels for inter-goroutine communication</li>
<li>Blocking message creation until status arrives (production)</li>
<li>Blocking status creation until message exists</li>
<li>Handling rollback scenarios gracefully</li>
<li>Preventing race conditions with mutex locks</li>
<li>Cleaning up resources automatically</li>
<li>Providing configurable timeouts</li>
</ul>
<p>This design ensures every message has an associated status, even when WhatsApp's webhooks arrive faster than the server can persist messages.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../support/consulting/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Consulting Services">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Consulting Services
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Astervia
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Astervia/wacraft" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/orgs/astervia" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="support/plans" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m47.6 300.4 180.7 168.7c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9l180.7-168.7c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141-45.6-7.6-92 7.3-124.6 39.9l-12 12-12-12c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5"/></svg>
    </a>
  
    
    
    
    
    <a href="bitcoin:bc1qh0tl3tn9xum66htma92lypj7s6ryr6uymut9sh" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248m-141.651-35.33c4.937-32.999-20.191-50.739-54.55-62.573l11.146-44.702-27.213-6.781-10.851 43.524c-7.154-1.783-14.502-3.464-21.803-5.13l10.929-43.81-27.198-6.781-11.153 44.686c-5.922-1.349-11.735-2.682-17.377-4.084l.031-.14-37.53-9.37-7.239 29.062s20.191 4.627 19.765 4.913c11.022 2.751 13.014 10.044 12.68 15.825l-12.696 50.925c.76.194 1.744.473 2.829.907-.907-.225-1.876-.473-2.876-.713l-17.796 71.338c-1.349 3.348-4.767 8.37-12.471 6.464.271.395-19.78-4.937-19.78-4.937l-13.51 31.147 35.414 8.827c6.588 1.651 13.045 3.379 19.4 5.006l-11.262 45.213 27.182 6.781 11.153-44.733a1038 1038 0 0 0 21.687 5.627l-11.115 44.523 27.213 6.781 11.262-45.128c46.404 8.781 81.299 5.239 95.986-36.727 11.836-33.79-.589-53.281-25.004-65.991 17.78-4.098 31.174-15.792 34.747-39.949m-62.177 87.179c-8.41 33.79-65.308 15.523-83.755 10.943l14.944-59.899c18.446 4.603 77.6 13.717 68.811 48.956m8.417-87.667c-7.673 30.736-55.031 15.12-70.393 11.292l13.548-54.327c15.363 3.828 64.836 10.973 56.845 43.035"/></svg>
    </a>
  
    
    
    
    
    <a href="lightning:evilpantry77@walletofsatoshi.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.4 44.6c5.9-13.7 1.5-29.7-10.6-38.5s-28.6-8-39.9 1.8l-256 224c-10 8.8-13.6 22.9-8.9 35.3S50.7 288 64 288h111.5L98.6 467.4c-5.9 13.7-1.5 29.7 10.6 38.5s28.6 8 39.9-1.8l256-224c10-8.8 13.6-22.9 8.9-35.3s-16.6-20.7-30-20.7H272.5z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.footer"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>